(function(t){function e(e){for(var i,o,r=e[0],c=e[1],d=e[2],l=0,u=[];l<r.length;l++)o=r[l],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&u.push(a[o][0]),a[o]=0;for(i in c)Object.prototype.hasOwnProperty.call(c,i)&&(t[i]=c[i]);h&&h(e);while(u.length)u.shift()();return n.push.apply(n,d||[]),s()}function s(){for(var t,e=0;e<n.length;e++){for(var s=n[e],i=!0,o=1;o<s.length;o++){var c=s[o];0!==a[c]&&(i=!1)}i&&(n.splice(e--,1),t=r(r.s=s[0]))}return t}var i={},a={app:0},n=[];function o(t){return r.p+"static/js/"+({about:"about"}[t]||t)+"."+{about:"347e7793"}[t]+".js"}function r(e){if(i[e])return i[e].exports;var s=i[e]={i:e,l:!1,exports:{}};return t[e].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.e=function(t){var e=[],s=a[t];if(0!==s)if(s)e.push(s[2]);else{var i=new Promise((function(e,i){s=a[t]=[e,i]}));e.push(s[2]=i);var n,c=document.createElement("script");c.charset="utf-8",c.timeout=120,r.nc&&c.setAttribute("nonce",r.nc),c.src=o(t);var d=new Error;n=function(e){c.onerror=c.onload=null,clearTimeout(l);var s=a[t];if(0!==s){if(s){var i=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src;d.message="Loading chunk "+t+" failed.\n("+i+": "+n+")",d.name="ChunkLoadError",d.type=i,d.request=n,s[1](d)}a[t]=void 0}};var l=setTimeout((function(){n({type:"timeout",target:c})}),12e4);c.onerror=c.onload=n,document.head.appendChild(c)}return Promise.all(e)},r.m=t,r.c=i,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(s,i,function(e){return t[e]}.bind(null,i));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="../dist/",r.oe=function(t){throw console.error(t),t};var c=window["webpackJsonp"]=window["webpackJsonp"]||[],d=c.push.bind(c);c.push=e,c=c.slice();for(var l=0;l<c.length;l++)e(c[l]);var h=d;n.push([0,"chunk-vendors"]),s()})({0:function(t,e,s){t.exports=s("56d7")},"034f":function(t,e,s){"use strict";var i=s("85ec"),a=s.n(i);a.a},"56d7":function(t,e,s){"use strict";s.r(e);s("e260"),s("e6cf"),s("cca6"),s("a79d");var i=s("2b0e"),a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{attrs:{id:"app"}},[s("div",{attrs:{id:"nav"}},[s("router-link",{attrs:{to:"/"}},[t._v("Home")]),t._v(" | "),s("router-link",{attrs:{to:"/Calibration"}},[t._v("Calibration")]),t._v(" | "),s("router-link",{attrs:{to:"/about"}},[t._v("About")])],1),s("router-view")],1)},n=[],o=(s("034f"),s("2877")),r={},c=Object(o["a"])(r,a,n,!1,null,null,null),d=c.exports,l=(s("d3b7"),s("8c4f")),h=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home"},[s("CalibrationOld",{attrs:{msg:"Loading"}})],1)},u=[],f=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"app",attrs:{id:"app"}},[s("div",{staticClass:"webcamOld"},[s("video",{ref:"videoSrc",staticClass:"webcamOld-video",attrs:{width:t.videoWidth,height:t.videoHeight},on:{canplay:t.onSourceReady}},[t._v("Your browser does not support this application.")]),s("canvas",{ref:"canvas",staticClass:"webcam-canvas",attrs:{width:t.videoWidth,height:t.videoHeight}})]),s("p",{staticClass:"msgOld"},[t._v(t._s(t.msg))])])},v=[],p=s("3191"),m=s.n(p),g=s("294d"),w=s.n(g),b="../dist/",C=null,M={name:"app",data:function(){return{videoWidth:window.innerWidth,videoHeight:window.innerHeight,stream:null,stats:null,canvasCtx:null,faceClassifier:null,detectMat:null,videoCap:null,faceVect:null,processTimer:null,msg:""}},methods:{startCamera:function(){var t=this,e={audio:!1,video:{width:{facingMode:"environment",min:960,ideal:window.innerWidth,max:1920},height:{min:540,ideal:window.innerHeight,max:1080}}};w()(e,(function(e,s){if(e)return t.setMsg("getUserMedia failed","warn"),void console.warn(e);t.setMsg("getUserMedia success"),t.$refs.videoSrc.srcObject=s,t.$refs.videoSrc.play(),t.stream=s,console.log(s)}))},stopCamera:function(){this.stream&&(this.setMsg("stopCamera"),this.stopVideoProcessing(),this.$refs.videoSrc.pause(),this.$refs.videoSrc.srcObject=null,this.stream.getVideoTracks()[0].stop(),this.stream=null)},onSourceReady:function(){this.setMsg("onSourceReady."),this.videoWidth=this.$refs.videoSrc.videoWidth,this.videoHeight=this.$refs.videoSrc.videoHeight,this.canvasCtx=this.$refs.canvas.getContext("2d"),console.log("get window size "+window.innerWidth+" : "+window.innerHeight),this.startVideoProcessing()},initStats:function(){this.stats=new m.a,this.stats.showPanel(0),this.$refs.app.appendChild(this.stats.dom)},loadOpenCv:function(){var t=this;if(window.WebAssembly){this.setMsg("loading OpenCv.js");var e=document.createElement("script");e.type="text/javascript",e.async="async",e.src="".concat(b,"libs/opencv.js"),document.body.appendChild(e),e.onload=function(){t.setMsg("OpenCV.js is loaded.")},window.Module={wasmBinaryFile:"".concat(b,"libs/opencv_js.wasm"),preRun:function(){t.setMsg("loading haarcascade_frontalface_default.xml"),window.Module.FS_createPreloadedFile("/","haarcascade_frontalface","".concat(b,"data/haarcascade_frontalface_default.xml"),!0,!1)},_main:function(){t.setMsg("OpenCV.js is ready."),C=window.cv,t.startVideoProcessing()}}}else this.setMsg("Your web browser doesn't support WebAssembly.","warn")},startVideoProcessing:function(){if(this.stream){var t=this;setTimeout((function(){t.canvasCtx.drawImage(t.$refs.videoSrc,0,0,t.videoWidth,t.videoHeight),t.startVideoProcessing()}),30)}else this.setMsg("Please startup your webcam.","warn")},stopVideoProcessing:function(){cancelAnimationFrame(this.processTimer)},processVideo:function(){this.$refs.videoSrc?(this.stats.begin(),this.videoCap.read(this.srcMat),C.cvtColor(this.srcMat,this.detectMat,C.COLOR_RGBA2GRAY,0),C.pyrDown(this.detectMat,this.detectMat),C.pyrDown(this.detectMat,this.detectMat),this.faceClassifier.detectMultiScale(this.detectMat,this.faceVect,1.1,3,0),this.drawFace(),this.stats.end(),this.processTimer=requestAnimationFrame(this.processVideo)):this.setMsg("Video stream not found.","warn")},drawFace:function(){this.canvasCtx.clearRect(0,0,this.videoWidth,this.videoHeight);for(var t=0;t<this.faceVect.size();++t){var e=this.faceVect.get(t);e.width>0&&e.height>0&&(this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="red",this.canvasCtx.strokeRect(4*e.x,4*e.y,4*e.width,4*e.height))}},setMsg:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";this.msg=t,console[e](t)}},mounted:function(){console.log('current url : "https://readlensnumberdev.coastalvision.cn"'),this.startCamera()},beforeDestroy:function(){console.log("destroy"),this.stopCamera()}},y=M,S=(s("decb"),Object(o["a"])(y,f,v,!1,null,null,null)),_=S.exports,x={name:"Home",components:{CalibrationOld:_}},O=x,V=Object(o["a"])(O,h,u,!1,null,null,null),j=V.exports,$=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"CalibrationNew"},[s("CalibrationNew",{attrs:{msg:"Loading"}})],1)},P=[],W=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{ref:"app",attrs:{id:"app"}},[s("div",{staticClass:"webcam"},[s("video",{ref:"videoSrc",staticClass:"webcam-video",attrs:{width:t.videoWidth,height:t.videoHeight},on:{canplay:t.onSourceReady}},[t._v("Your browser does not support this application.")]),s("canvas",{ref:"canvas",staticClass:"webcam-canvas",attrs:{width:t.videoWidth,height:t.videoHeight}}),s("canvas",{ref:"canvas"})]),s("p",{staticClass:"msg"},[t._v(t._s(t.msg))])])},H=[],T=(s("4160"),"../dist/"),R=null,k={name:"app",data:function(){return{videoWidth:1920,videoHeight:1080,stream:null,stats:null,canvasCtx:null,faceClassifier:null,detectMat:null,videoCap:null,faceVect:null,processTimer:null,msg:""}},methods:{startCamera:function(){var t=this,e={audio:!1,video:{width:{facingMode:"user",min:960,ideal:1280,max:1920},height:{min:540,ideal:720,max:1080}}};w()(e,(function(e,s){if(e)return t.setMsg("getUserMedia failed","warn"),void console.warn(e);t.setMsg("getUserMedia success"),t.stream=s,t.$refs.videoSrc.srcObject=s,t.$refs.videoSrc.play()}))},stopCamera:function(){this.stream&&(this.setMsg("stopCamera"),this.stopVideoProcessing(),this.$refs.videoSrc.pause(),this.$refs.videoSrc.srcObject=null,this.stream.getVideoTracks()[0].stop(),this.stream=null)},onSourceReady:function(){this.setMsg("onSourceReady."),this.videoWidth=this.$refs.videoSrc.videoWidth,this.videoHeight=this.$refs.videoSrc.videoHeight,console.log(this.videoWidth,this.videoHeight),window.Module},initStats:function(){this.stats=new m.a,this.stats.showPanel(0),this.$refs.app.appendChild(this.stats.dom)},loadOpenCv:function(){var t=this;if(window.WebAssembly)if(this.$store.state.lensCv)console.log("cached Done"),this.createTemplateMatch();else{this.setMsg("loading templateMatch.js");var e=document.createElement("script");e.type="text/javascript",e.async="async",e.src="".concat(T,"libs/templateMatch.js"),document.body.appendChild(e),e.onload=function(){t.setMsg("templateMatch.js is loaded.")},window.Module={wasmBinaryFile:"".concat(T,"libs/templateMatch.wasm")};var s=this;window.Module.onRuntimeInitialized=function(){console.log("Done"),s.$store.state.lensCv=window.Module,s.createTemplateMatch()}}else this.setMsg("Your web browser doesn't support WebAssembly.","warn")},createTemplateMatch:function(){var t=this.$store.state.lensCv.createTemplate(60,!1);this.loadTemplateMatchPattern(t,60)},loadTemplateMatchPattern:function(t,e){for(var s=this.$refs.canvas,i=s.getContext("2d"),a=[],n=0;n<e*e;n++)a.push(t[n]),a.push(t[n]),a.push(t[n]),a.push(255);s.width=e,s.height=e;var o=i.createImageData(e,e);o.data.set?o.data.set(a):a.forEach((function(t,e){o.data[e]=t})),i.putImageData(o,0,0)},startVideoProcessing:function(){this.setMsg("startVideoProcessing."),this.stream?(this.canvasCtx=this.$refs.canvas.getContext("2d"),this.faceClassifier=new R.CascadeClassifier,this.faceClassifier.load("haarcascade_frontalface"),this.srcMat=new R.Mat(this.videoHeight,this.videoWidth,R.CV_8UC4),this.detectMat=new R.Mat,this.videoCap=new R.VideoCapture(this.$refs.videoSrc),this.faceVect=new R.RectVector,this.initStats(),this.processTimer=requestAnimationFrame(this.processVideo)):this.setMsg("Please startup your webcam.","warn")},stopVideoProcessing:function(){cancelAnimationFrame(this.processTimer),this.stats.end(),this.faceClassifier&&!this.faceClassifier.isDeleted()&&this.faceClassifier.delete(),this.srcMat.delete(),this.detectMat.delete(),this.faceVect.delete(),this.canvasCtx.clearRect(0,0,this.videoWidth,this.videoHeight)},processVideo:function(){this.$refs.videoSrc?(this.stats.begin(),this.videoCap.read(this.srcMat),R.cvtColor(this.srcMat,this.detectMat,R.COLOR_RGBA2GRAY,0),R.pyrDown(this.detectMat,this.detectMat),R.pyrDown(this.detectMat,this.detectMat),this.faceClassifier.detectMultiScale(this.detectMat,this.faceVect,1.1,3,0),this.drawFace(),this.stats.end(),this.processTimer=requestAnimationFrame(this.processVideo)):this.setMsg("Video stream not found.","warn")},drawFace:function(){this.canvasCtx.clearRect(0,0,this.videoWidth,this.videoHeight);for(var t=0;t<this.faceVect.size();++t){var e=this.faceVect.get(t);e.width>0&&e.height>0&&(this.canvasCtx.lineWidth=2,this.canvasCtx.strokeStyle="red",this.canvasCtx.strokeRect(4*e.x,4*e.y,4*e.width,4*e.height))}},setMsg:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";this.msg=t,console[e](t)}},mounted:function(){console.log('current url : "https://readlensnumberdev.coastalvision.cn" : '+this.$store.state.title),this.startCamera(),this.loadOpenCv()},beforeDestroy:function(){this.stopCamera()}},A=k,F=(s("f6bd"),Object(o["a"])(A,W,H,!1,null,null,null)),E=F.exports,D={name:"Calibration",components:{CalibrationNew:E}},L=D,N=Object(o["a"])(L,$,P,!1,null,null,null),Y=N.exports;i["a"].use(l["a"]);var q=[{path:"/",name:"Home",component:j},{path:"/Calibration",name:"Calibration",component:Y},{path:"/about",name:"About",component:function(){return s.e("about").then(s.bind(null,"36df"))}}],B=new l["a"]({base:"../dist/",routes:q}),U=B,z=s("9483");Object(z["a"])("".concat("../dist/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(t){console.error("Error during service worker registration:",t)}});var G=s("2f62");i["a"].use(G["a"]);var I=new G["a"].Store({state:{title:"Lenscopy",lensCv:null}});i["a"].config.productionTip=!1,new i["a"]({store:I,router:U,render:function(t){return t(d)}}).$mount("#app")},"688c":function(t,e,s){},"85ec":function(t,e,s){},d280:function(t,e,s){},decb:function(t,e,s){"use strict";var i=s("d280"),a=s.n(i);a.a},f6bd:function(t,e,s){"use strict";var i=s("688c"),a=s.n(i);a.a}});
//# sourceMappingURL=app.4edc9531.js.map